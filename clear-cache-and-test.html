<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Cache & Test Staging</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .button {
            background: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover { background: #005a87; }
        .button.danger { background: #dc3545; }
        .button.danger:hover { background: #c82333; }
        .button.success { background: #28a745; }
        .button.success:hover { background: #218838; }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßπ Clear Cache & Test Staging Connection</h1>
        
        <div class="section">
            <h2>1. Current Environment</h2>
            <div id="env-info" class="result info">
                Loading environment info...
            </div>
            <button class="button" onclick="showEnvironmentInfo()">Refresh Environment Info</button>
        </div>

        <div class="section">
            <h2>2. Clear Local Storage Cache</h2>
            <p>This will clear all cached data including login tokens and user data.</p>
            <button class="button danger" onclick="clearAllCache()">Clear All Cache</button>
            <button class="button" onclick="showCurrentCache()">Show Current Cache</button>
            <div id="cache-info" class="result info"></div>
        </div>

        <div class="section">
            <h2>3. Test Staging API Connection</h2>
            <p>Test if the frontend can connect to staging.jalsah.app</p>
            <button class="button success" onclick="testStagingConnection()">Test Staging API</button>
            <button class="button" onclick="testAuthEndpoint()">Test Auth Endpoint</button>
            <button class="button" onclick="testWordPressAPI()">Test WordPress API</button>
            <div id="api-test-results"></div>
        </div>

        <div class="section">
            <h2>4. Network Request Monitor</h2>
            <p>Monitor API requests to see where they're going:</p>
            <button class="button" onclick="startNetworkMonitor()">Start Monitoring</button>
            <button class="button" onclick="clearNetworkLog()">Clear Log</button>
            <div id="network-log" class="result info">
                <strong>Network requests will appear here...</strong>
            </div>
        </div>

        <div class="section">
            <h2>5. Quick Actions</h2>
            <button class="button" onclick="openFrontend()">Open Frontend (localhost:3000)</button>
            <button class="button" onclick="openStaging()">Open Staging Site</button>
            <button class="button" onclick="reloadPage()">Reload This Page</button>
        </div>
    </div>

    <script>
        const STAGING_URL = 'https://staging.jalsah.app';
        const FRONTEND_URL = 'http://localhost:3000';
        
        // Show environment information
        function showEnvironmentInfo() {
            const envInfo = document.getElementById('env-info');
            const info = {
                'Current URL': window.location.href,
                'User Agent': navigator.userAgent,
                'Local Storage Available': typeof(Storage) !== "undefined",
                'Session Storage Available': typeof(sessionStorage) !== "undefined",
                'Cookies Enabled': navigator.cookieEnabled,
                'Online Status': navigator.onLine,
                'Timestamp': new Date().toISOString()
            };
            
            envInfo.innerHTML = '<pre>' + JSON.stringify(info, null, 2) + '</pre>';
        }

        // Clear all cache
        function clearAllCache() {
            try {
                // Clear localStorage
                localStorage.clear();
                
                // Clear sessionStorage
                sessionStorage.clear();
                
                // Clear cookies (basic approach)
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                
                showResult('‚úÖ All cache cleared successfully!', 'success');
                showCurrentCache();
            } catch (error) {
                showResult('‚ùå Error clearing cache: ' + error.message, 'error');
            }
        }

        // Show current cache
        function showCurrentCache() {
            const cacheInfo = document.getElementById('cache-info');
            const cache = {};
            
            // Get localStorage items
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                cache[key] = localStorage.getItem(key);
            }
            
            if (Object.keys(cache).length === 0) {
                cacheInfo.innerHTML = '<div class="success">‚úÖ No cached data found</div>';
            } else {
                cacheInfo.innerHTML = '<pre>' + JSON.stringify(cache, null, 2) + '</pre>';
            }
        }

        // Test staging connection
        async function testStagingConnection() {
            showResult('üîÑ Testing staging connection...', 'info');
            
            try {
                const response = await fetch(`${STAGING_URL}/wp-json/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showResult(`‚úÖ Staging connection successful! Site: ${data.name || 'WordPress'}`, 'success');
                } else {
                    showResult(`‚ùå Staging connection failed: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Staging connection error: ${error.message}`, 'error');
            }
        }

        // Test auth endpoint
        async function testAuthEndpoint() {
            showResult('üîÑ Testing auth endpoint...', 'info');
            
            try {
                const response = await fetch(`${STAGING_URL}/api/ai/auth`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'test@example.com',
                        password: 'test123'
                    })
                });
                
                if (response.status === 401) {
                    showResult('‚úÖ Auth endpoint responding (401 expected for invalid credentials)', 'success');
                } else if (response.ok) {
                    showResult('‚ö†Ô∏è Auth endpoint responding (unexpected success)', 'warning');
                } else {
                    showResult(`‚ùå Auth endpoint error: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Auth endpoint error: ${error.message}`, 'error');
            }
        }

        // Test WordPress API
        async function testWordPressAPI() {
            showResult('üîÑ Testing WordPress API...', 'info');
            
            try {
                const response = await fetch(`${STAGING_URL}/wp-json/wp/v2/posts?per_page=1`);
                
                if (response.ok) {
                    const data = await response.json();
                    showResult(`‚úÖ WordPress API working! Found ${data.length} posts`, 'success');
                } else {
                    showResult(`‚ùå WordPress API error: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå WordPress API error: ${error.message}`, 'error');
            }
        }

        // Network monitoring
        let networkLog = [];
        
        function startNetworkMonitor() {
            // Override fetch to monitor requests
            const originalFetch = window.fetch;
            window.fetch = function(...args) {
                const url = args[0];
                const timestamp = new Date().toLocaleTimeString();
                
                networkLog.push({
                    timestamp,
                    url: typeof url === 'string' ? url : url.url,
                    method: args[1]?.method || 'GET'
                });
                
                updateNetworkLog();
                
                return originalFetch.apply(this, args);
            };
            
            showResult('‚úÖ Network monitoring started! All fetch requests will be logged.', 'success');
        }

        function updateNetworkLog() {
            const logDiv = document.getElementById('network-log');
            if (networkLog.length === 0) {
                logDiv.innerHTML = '<strong>No network requests logged yet...</strong>';
                return;
            }
            
            const logHtml = networkLog.map(log => 
                `<div><strong>${log.timestamp}</strong> ${log.method} ${log.url}</div>`
            ).join('');
            
            logDiv.innerHTML = logHtml;
        }

        function clearNetworkLog() {
            networkLog = [];
            updateNetworkLog();
        }

        // Utility functions
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('api-test-results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            resultsDiv.appendChild(div);
        }

        function openFrontend() {
            window.open(FRONTEND_URL, '_blank');
        }

        function openStaging() {
            window.open(STAGING_URL, '_blank');
        }

        function reloadPage() {
            location.reload();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showEnvironmentInfo();
            showCurrentCache();
        });
    </script>
</body>
</html>
