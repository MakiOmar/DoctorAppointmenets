<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staging API Debug Tool</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result { 
            margin: 10px 0; 
            padding: 15px; 
            border-radius: 8px; 
            border-left: 4px solid;
        }
        .success { 
            background-color: #d4edda; 
            color: #155724; 
            border-left-color: #28a745;
        }
        .error { 
            background-color: #f8d7da; 
            color: #721c24; 
            border-left-color: #dc3545;
        }
        .loading { 
            background-color: #fff3cd; 
            color: #856404; 
            border-left-color: #ffc107;
        }
        .warning {
            background-color: #ffeaa7;
            color: #856404;
            border-left-color: #f39c12;
        }
        button { 
            padding: 12px 24px; 
            margin: 5px; 
            cursor: pointer; 
            border: none;
            border-radius: 5px;
            font-weight: bold;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; color: white; }
        pre { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            overflow-x: auto; 
            border: 1px solid #e9ecef;
            font-size: 12px;
        }
        .config-panel {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .endpoint-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .endpoint-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-unknown { background: #6c757d; }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-loading { background: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Staging API Debug Tool</h1>
        <p>Testing API endpoints on <strong>https://staging.jalsah.app</strong></p>
        
        <div class="config-panel">
            <h3>üìã Test Configuration</h3>
            <p><strong>Staging URL:</strong> <span id="staging-url">https://staging.jalsah.app</span></p>
            <p><strong>API Base URL:</strong> <span id="api-base-url">/api/ai</span></p>
            <p><strong>Test Time:</strong> <span id="test-time"></span></p>
        </div>

        <div>
            <h2>üöÄ Quick Tests</h2>
            <button class="btn-primary" onclick="testAllEndpoints()">Test All Endpoints</button>
            <button class="btn-success" onclick="testBasicEndpoints()">Test Basic Endpoints</button>
            <button class="btn-warning" onclick="testAuthEndpoints()">Test Auth Endpoints</button>
            <button class="btn-danger" onclick="clearResults()">Clear Results</button>
        </div>

        <div class="endpoint-grid">
            <div class="endpoint-card">
                <h4><span class="status-indicator status-unknown" id="ping-status"></span>Ping Test</h4>
                <p>Basic connectivity test</p>
                <button onclick="testPing()" class="btn-primary">Test Ping</button>
            </div>
            
            <div class="endpoint-card">
                <h4><span class="status-indicator status-unknown" id="debug-status"></span>Debug Test</h4>
                <p>Detailed request information</p>
                <button onclick="testDebug()" class="btn-primary">Test Debug</button>
            </div>
            
            <div class="endpoint-card">
                <h4><span class="status-indicator status-unknown" id="register-status"></span>Registration Test</h4>
                <p>User registration endpoint</p>
                <button onclick="testRegister()" class="btn-primary">Test Registration</button>
            </div>
            
            <div class="endpoint-card">
                <h4><span class="status-indicator status-unknown" id="login-status"></span>Login Test</h4>
                <p>User login endpoint</p>
                <button onclick="testLogin()" class="btn-primary">Test Login</button>
            </div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // Configuration
        const config = {
            stagingUrl: 'https://staging.jalsah.app',
            apiBaseUrl: '/api/ai'
        };

        // Update test time
        document.getElementById('test-time').textContent = new Date().toLocaleString();

        function updateStatus(endpoint, status) {
            const statusElement = document.getElementById(`${endpoint}-status`);
            statusElement.className = `status-indicator status-${status}`;
        }

        function addResult(message, type = 'success') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${message}</span>
                    <small>${new Date().toLocaleTimeString()}</small>
                </div>
            `;
            resultsDiv.appendChild(resultDiv);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function addLoadingResult(message) {
            addResult(message, 'loading');
        }

        async function makeRequest(url, options = {}) {
            const defaultOptions = {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
                mode: 'cors',
                credentials: 'include'
            };

            const finalOptions = { ...defaultOptions, ...options };
            
            try {
                console.log(`üåê Making request to: ${url}`);
                console.log(`üìã Request options:`, finalOptions);
                
                const response = await fetch(url, finalOptions);
                const data = await response.text();
                
                console.log(`üì• Response status: ${response.status}`);
                console.log(`üìÑ Response headers:`, Object.fromEntries(response.headers.entries()));
                console.log(`üì¶ Response data:`, data);
                
                let jsonData;
                try {
                    jsonData = JSON.parse(data);
                } catch (e) {
                    jsonData = { raw: data };
                }

                return {
                    ok: response.ok,
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries()),
                    data: jsonData,
                    url: response.url
                };
            } catch (error) {
                console.error(`‚ùå Request failed:`, error);
                return {
                    ok: false,
                    error: error.message,
                    url: url
                };
            }
        }

        async function testPing() {
            updateStatus('ping', 'loading');
            addLoadingResult('üîÑ Testing ping endpoint...');
            
            const response = await makeRequest(`${config.stagingUrl}${config.apiBaseUrl}/ping`);
            
            if (response.ok) {
                updateStatus('ping', 'success');
                addResult(`
                    ‚úÖ <strong>Ping Test Successful</strong><br>
                    Status: ${response.status}<br>
                    Data: <pre>${JSON.stringify(response.data, null, 2)}</pre>
                `, 'success');
            } else {
                updateStatus('ping', 'error');
                addResult(`
                    ‚ùå <strong>Ping Test Failed</strong><br>
                    Status: ${response.status}<br>
                    Error: ${response.error || response.statusText}<br>
                    Data: <pre>${JSON.stringify(response.data, null, 2)}</pre><br>
                    URL: ${response.url}
                `, 'error');
            }
        }

        async function testDebug() {
            updateStatus('debug', 'loading');
            addLoadingResult('üîÑ Testing debug endpoint...');
            
            const response = await makeRequest(`${config.stagingUrl}${config.apiBaseUrl}/debug`);
            
            if (response.ok) {
                updateStatus('debug', 'success');
                addResult(`
                    ‚úÖ <strong>Debug Test Successful</strong><br>
                    Status: ${response.status}<br>
                    Data: <pre>${JSON.stringify(response.data, null, 2)}</pre>
                `, 'success');
            } else {
                updateStatus('debug', 'error');
                addResult(`
                    ‚ùå <strong>Debug Test Failed</strong><br>
                    Status: ${response.status}<br>
                    Error: ${response.error || response.statusText}<br>
                    Data: <pre>${JSON.stringify(response.data, null, 2)}</pre><br>
                    URL: ${response.url}
                `, 'error');
            }
        }

        async function testRegister() {
            updateStatus('register', 'loading');
            addLoadingResult('üîÑ Testing registration endpoint...');
            
            const testData = {
                first_name: 'Test',
                last_name: 'User',
                age: 25,
                email: `test${Date.now()}@example.com`,
                phone: '+1234567890',
                whatsapp: '+1234567890',
                country: 'Egypt',
                password: 'testpassword123'
            };

            const response = await makeRequest(`${config.stagingUrl}${config.apiBaseUrl}/auth/register`, {
                method: 'POST',
                body: JSON.stringify(testData)
            });
            
            if (response.ok) {
                updateStatus('register', 'success');
                addResult(`
                    ‚úÖ <strong>Registration Test Successful</strong><br>
                    Status: ${response.status}<br>
                    Data: <pre>${JSON.stringify(response.data, null, 2)}</pre>
                `, 'success');
            } else {
                updateStatus('register', 'error');
                addResult(`
                    ‚ùå <strong>Registration Test Failed</strong><br>
                    Status: ${response.status}<br>
                    Error: ${response.error || response.statusText}<br>
                    Data: <pre>${JSON.stringify(response.data, null, 2)}</pre><br>
                    URL: ${response.url}
                `, 'error');
            }
        }

        async function testLogin() {
            updateStatus('login', 'loading');
            addLoadingResult('üîÑ Testing login endpoint...');
            
            const testData = {
                email: 'test@example.com',
                password: 'testpassword123'
            };

            const response = await makeRequest(`${config.stagingUrl}${config.apiBaseUrl}/auth`, {
                method: 'POST',
                body: JSON.stringify(testData)
            });
            
            if (response.ok) {
                updateStatus('login', 'success');
                addResult(`
                    ‚úÖ <strong>Login Test Successful</strong><br>
                    Status: ${response.status}<br>
                    Data: <pre>${JSON.stringify(response.data, null, 2)}</pre>
                `, 'success');
            } else {
                updateStatus('login', 'error');
                addResult(`
                    ‚ùå <strong>Login Test Failed</strong><br>
                    Status: ${response.status}<br>
                    Error: ${response.error || response.statusText}<br>
                    Data: <pre>${JSON.stringify(response.data, null, 2)}</pre><br>
                    URL: ${response.url}
                `, 'error');
            }
        }

        async function testBasicEndpoints() {
            addResult('üöÄ Starting basic endpoint tests...', 'loading');
            
            await testPing();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testDebug();
            
            addResult('‚úÖ Basic endpoint tests completed!', 'success');
        }

        async function testAuthEndpoints() {
            addResult('üîê Starting auth endpoint tests...', 'loading');
            
            await testRegister();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testLogin();
            
            addResult('‚úÖ Auth endpoint tests completed!', 'success');
        }

        async function testAllEndpoints() {
            addResult('üöÄ Starting all endpoint tests...', 'loading');
            
            await testPing();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testDebug();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testRegister();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testLogin();
            
            addResult('‚úÖ All endpoint tests completed!', 'success');
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            // Reset all status indicators
            ['ping', 'debug', 'register', 'login'].forEach(endpoint => {
                updateStatus(endpoint, 'unknown');
            });
        }

        // Auto-run basic test on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                addResult('üîÑ Auto-running basic connectivity test...', 'loading');
                testPing();
            }, 1000);
        });
    </script>
</body>
</html>
