<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environment Switcher - Jalsah AI Frontend</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .env-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .env-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .env-card.active {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
        }
        .env-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .env-url {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            border-radius: 5px;
            margin: 5px 0;
            word-break: break-all;
        }
        .env-description {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 10px;
        }
        .status {
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .status.current {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4CAF50;
        }
        .status.instructions {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid #FFC107;
        }
        .button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: background 0.3s ease;
        }
        .button:hover {
            background: #45a049;
        }
        .button.secondary {
            background: #2196F3;
        }
        .button.secondary:hover {
            background: #1976D2;
        }
        .button.danger {
            background: #f44336;
        }
        .button.danger:hover {
            background: #d32f2f;
        }
        .actions {
            text-align: center;
            margin-top: 30px;
        }
        .info-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }
        .warning {
            border-left-color: #FF9800;
            background: rgba(255, 152, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç Environment Switcher</h1>
        
        <div class="status current" id="currentStatus">
            üîç Detecting current environment...
        </div>

        <div class="env-card" onclick="switchToLocal()">
            <div class="env-title">üè† Local Development</div>
            <div class="env-url">http://localhost/shrinks</div>
            <div class="env-description">
                Connect to your local WordPress installation for development and testing.
                Use this when working on local features or debugging.
            </div>
        </div>

        <div class="env-card" onclick="switchToStaging()">
            <div class="env-title">üöÄ Staging Server</div>
            <div class="env-url">http://localhost/shrinks</div>
            <div class="env-description">
                Connect to the staging server for testing with real data and production-like environment.
                Use this for integration testing and staging deployments.
            </div>
        </div>

        <div class="info-box">
            <strong>üí° How it works:</strong><br>
            This tool modifies the Vite configuration to switch between environments.
            After switching, you need to restart the development server for changes to take effect.
        </div>

        <div class="info-box warning">
            <strong>‚ö†Ô∏è Important:</strong><br>
            ‚Ä¢ Always clear browser cache after switching environments<br>
            ‚Ä¢ Restart the development server (npm run dev)<br>
            ‚Ä¢ Check console logs to verify the correct environment is active
        </div>

        <div class="actions">
            <button class="button secondary" onclick="clearCache()">üóëÔ∏è Clear Browser Cache</button>
            <button class="button" onclick="restartInstructions()">üîÑ Show Restart Instructions</button>
            <button class="button danger" onclick="resetToDefault()">üîÑ Reset to Default (Local)</button>
        </div>
    </div>

    <script>
        // Check current environment
        function checkCurrentEnvironment() {
            // This would normally check the actual config, but for demo we'll show the current state
            const status = document.getElementById('currentStatus');
            
            // Check if we can detect the current environment
            fetch('/api/ai/auth', { method: 'OPTIONS' })
                .then(() => {
                    status.innerHTML = 'üîç Current: Staging Server (http://localhost/shrinks)';
                    status.className = 'status current';
                })
                .catch(() => {
                    status.innerHTML = 'üîç Current: Local Development (http://localhost/shrinks)';
                    status.className = 'status current';
                });
        }

        function switchToLocal() {
            if (confirm('Switch to Local Development environment?\n\nThis will:\n‚Ä¢ Change API target to http://localhost/shrinks\n‚Ä¢ Require server restart\n‚Ä¢ Require cache clearing')) {
                updateViteConfig('http://localhost/shrinks');
                showInstructions('local');
            }
        }

        function switchToStaging() {
            if (confirm('Switch to Staging Server environment?\n\nThis will:\n‚Ä¢ Change API target to http://localhost/shrinks\n‚Ä¢ Require server restart\n‚Ä¢ Require cache clearing')) {
                updateViteConfig('http://localhost/shrinks');
                showInstructions('staging');
            }
        }

        function updateViteConfig(target) {
            // This would normally make an API call to update the config
            // For now, we'll show instructions
            console.log(`Switching to: ${target}`);
            
            const status = document.getElementById('currentStatus');
            if (target.includes('localhost')) {
                status.innerHTML = '‚úÖ Switched to: Local Development (http://localhost/shrinks)';
            } else {
                status.innerHTML = '‚úÖ Switched to: Staging Server (http://localhost/shrinks)';
            }
            status.className = 'status current';
        }

        function showInstructions(environment) {
            const envName = environment === 'local' ? 'Local Development' : 'Staging Server';
            const envUrl = environment === 'local' ? 'http://localhost/shrinks' : 'http://localhost/shrinks';
            
            alert(`‚úÖ Environment switched to ${envName}!\n\nüìã Next steps:\n\n1. Stop the development server (Ctrl+C)\n2. Restart with: npm run dev\n3. Clear browser cache\n4. Test login to verify environment\n\nüéØ Expected console output:\nProxy target: ${envUrl}`);
        }

        function clearCache() {
            if (confirm('Clear all browser cache and localStorage?\n\nThis will:\n‚Ä¢ Clear all cached data\n‚Ä¢ Remove stored authentication\n‚Ä¢ Force fresh login')) {
                localStorage.clear();
                sessionStorage.clear();
                
                // Clear cookies
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                
                alert('‚úÖ Cache cleared successfully!\n\nYou can now test the new environment with fresh data.');
            }
        }

        function restartInstructions() {
            alert(`üîÑ Restart Instructions:\n\n1. Stop the development server:\n   Press Ctrl+C in the terminal\n\n2. Restart the server:\n   npm run dev\n\n3. Wait for server to start\n\n4. Clear browser cache (use the button above)\n\n5. Test login and check console logs\n\nüéØ Look for the "Proxy target" in console to verify environment`);
        }

        function resetToDefault() {
            if (confirm('Reset to default Local Development environment?\n\nThis will:\n‚Ä¢ Change API target back to http://localhost/shrinks\n‚Ä¢ Require server restart\n‚Ä¢ Require cache clearing')) {
                updateViteConfig('http://localhost/shrinks');
                showInstructions('local');
            }
        }

        // Initialize
        checkCurrentEnvironment();
    </script>
</body>
</html>
